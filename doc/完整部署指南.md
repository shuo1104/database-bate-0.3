# PhotoPolymer é…æ–¹æ•°æ®åº“ - å®Œæ•´éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£æä¾›ä»é›¶å¼€å§‹åœ¨æ–°æœåŠ¡å™¨ä¸Šéƒ¨ç½²ç³»ç»Ÿçš„å®Œæ•´æ­¥éª¤ã€‚

---

## ğŸ“‹ å‡†å¤‡å·¥ä½œï¼šå…‹éš†ä»£ç 

```bash
# 1. è¿›å…¥å·¥ä½œç›®å½•ï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰
cd /home/xgs/workspace

# 2. å…‹éš†ä»£ç 
git clone https://github.com/shuo1104/database-bate-0.3.git
cd database-bate-0.3
```

**âš ï¸ é‡è¦æç¤º**ï¼š
- è®°å½•æ‚¨çš„é¡¹ç›®è·¯å¾„ï¼Œåç»­é…ç½®éœ€è¦ä½¿ç”¨
- ç¤ºä¾‹ï¼š`/home/xgs/workspace/database-bate-0.3`

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šå®‰è£…ç³»ç»Ÿä¾èµ–

### 1. å®‰è£…ç³»ç»Ÿä¾èµ–

```bash
# æ›´æ–°åŒ…åˆ—è¡¨
sudo apt update

# å®‰è£… PostgreSQL æ•°æ®åº“
sudo apt install postgresql postgresql-contrib -y

# å®‰è£… Nginx
sudo apt install nginx -y

# å®‰è£… Python è™šæ‹Ÿç¯å¢ƒå·¥å…·
sudo apt install python3-venv python3-pip -y

# å®‰è£… Node.js å’Œ pnpm
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install nodejs -y
npm install -g pnpm
```

### 2. åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒç›®å½•
mkdir -p ~/venv

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv ~/venv/database

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source ~/venv/database/bin/activate

# å®‰è£…åç«¯ä¾èµ–ï¼ˆæ³¨æ„ï¼šæ²¡æœ‰ data_base ç›®å½•ï¼‰
cd ~/workspace/database-bate-0.3/backend_fastapi
pip install -r requirements.txt
```

**âš ï¸ è·¯å¾„è¯´æ˜**ï¼š
- âœ… æ­£ç¡®ï¼š`~/workspace/database-bate-0.3/backend_fastapi`
- âŒ é”™è¯¯ï¼š`~/workspace/data_base/database-bate-0.3/backend_fastapi`

### 3. å®‰è£…å‰ç«¯ä¾èµ–

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd ~/workspace/database-bate-0.3/frontend_vue3
pnpm install
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šé…ç½®è·¯å¾„ï¼ˆæ–°æœåŠ¡å™¨å¿…é¡»æ‰§è¡Œï¼‰

### è‡ªåŠ¨é…ç½®ï¼ˆæ¨èï¼‰

```bash
# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ~/workspace/database-bate-0.3

# è¿è¡Œè‡ªåŠ¨é…ç½®è„šæœ¬
bash setup_new_server.sh
```

è„šæœ¬ä¼šè¯¢é—®ï¼š
- ç”¨æˆ·åï¼ˆé»˜è®¤ï¼šå½“å‰ç”¨æˆ·ï¼‰
- ç”¨æˆ·ç»„ï¼ˆé»˜è®¤ï¼šå½“å‰ç”¨æˆ·ç»„ï¼‰
- é¡¹ç›®è·¯å¾„ï¼ˆé»˜è®¤ï¼šå½“å‰ç›®å½•ï¼‰
- è™šæ‹Ÿç¯å¢ƒè·¯å¾„ï¼ˆé»˜è®¤ï¼š~/venv/databaseï¼‰
- åç«¯ç«¯å£ï¼ˆé»˜è®¤ï¼š8000ï¼‰
- å‰ç«¯ç«¯å£ï¼ˆé»˜è®¤ï¼š8080ï¼‰

### æ‰‹åŠ¨é…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚æœä¸ä½¿ç”¨è‡ªåŠ¨è„šæœ¬ï¼Œéœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼š

**1. ä¿®æ”¹åç«¯æœåŠ¡é…ç½®**ï¼š
```bash
nano backend_fastapi/depoly/photopolymer-api.service
```

å°†æ‰€æœ‰è·¯å¾„ä¸­çš„ï¼š
- `xgs` â†’ æ›¿æ¢ä¸ºæ‚¨çš„ç”¨æˆ·å
- `/home/xgs/workspace/database-bate-0.3` â†’ æ›¿æ¢ä¸ºæ‚¨çš„é¡¹ç›®è·¯å¾„
- `/home/xgs/venv/database` â†’ æ›¿æ¢ä¸ºæ‚¨çš„è™šæ‹Ÿç¯å¢ƒè·¯å¾„

**2. ä¿®æ”¹å‰ç«¯ Nginx é…ç½®**ï¼š
```bash
nano frontend_vue3/depoly/photopolymer-frontend.conf
```

å°† `root` è·¯å¾„ä¿®æ”¹ä¸ºæ‚¨çš„å‰ç«¯æ„å»ºç›®å½•ã€‚

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šé…ç½®æ•°æ®åº“

### 1. å¯åŠ¨ PostgreSQL

```bash
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

### 2. åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·

```bash
# åˆ‡æ¢åˆ° postgres ç”¨æˆ·
sudo -u postgres psql
```

åœ¨ psql ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```sql
CREATE DATABASE photopolymer_formulation_db;
CREATE USER photopolymer_admin WITH PASSWORD 'root';
GRANT ALL PRIVILEGES ON DATABASE photopolymer_formulation_db TO photopolymer_admin;
\q
```

**âš ï¸ å®‰å…¨æç¤º**ï¼š
- ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨å¼ºå¯†ç æ›¿æ¢ `'root'`
- è®°å½•æ•°æ®åº“åã€ç”¨æˆ·åå’Œå¯†ç ï¼Œåç»­é…ç½®éœ€è¦ä½¿ç”¨

### 3. é…ç½®åç«¯æ•°æ®åº“è¿æ¥ï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœé¡¹ç›®æœ‰ç‹¬ç«‹çš„ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š

```bash
cd ~/workspace/database-bate-0.3/backend_fastapi

# æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç¯å¢ƒé…ç½®æ–‡ä»¶
ls env/.env.prod

# å¦‚æœå­˜åœ¨ï¼Œç¼–è¾‘é…ç½®
nano env/.env.prod
```

ä¿®æ”¹æ•°æ®åº“é…ç½®ï¼š
```env
DB_HOST=localhost
DB_PORT=5432
DB_NAME=photopolymer_formulation_db
DB_USER=photopolymer_admin
DB_PASSWORD=root
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šæ„å»ºå‰ç«¯

```bash
cd ~/workspace/database-bate-0.3/frontend_vue3
pnpm build
```

**éªŒè¯æ„å»º**ï¼š
```bash
ls -la dist/
```

åº”è¯¥çœ‹åˆ° `index.html` å’Œå…¶ä»–é™æ€æ–‡ä»¶ã€‚

---

## ç¬¬äº”éƒ¨åˆ†ï¼šéƒ¨ç½²æœåŠ¡

### ä½¿ç”¨ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd ~/workspace/database-bate-0.3
bash update_configs.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. åœæ­¢ç°æœ‰æœåŠ¡
2. å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°ç³»ç»Ÿç›®å½•
3. æµ‹è¯• Nginx é…ç½®
4. é‡æ–°åŠ è½½æœåŠ¡
5. å¯åŠ¨æ‰€æœ‰æœåŠ¡
6. æ˜¾ç¤ºæœåŠ¡çŠ¶æ€

### æ‰‹åŠ¨éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

å¦‚æœä¸ä½¿ç”¨è‡ªåŠ¨è„šæœ¬ï¼š

**1. éƒ¨ç½²åç«¯æœåŠ¡**ï¼š
```bash
sudo cp backend_fastapi/depoly/photopolymer-api.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl start photopolymer-api.service
sudo systemctl enable photopolymer-api.service
```

**2. éƒ¨ç½²å‰ç«¯ Nginx**ï¼š
```bash
sudo cp frontend_vue3/depoly/photopolymer-frontend.conf /etc/nginx/sites-available/photopolymer
sudo ln -sf /etc/nginx/sites-available/photopolymer /etc/nginx/sites-enabled/photopolymer
sudo nginx -t
sudo systemctl reload nginx
sudo systemctl enable nginx
```

---

## ç¬¬å…­éƒ¨åˆ†ï¼šéªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥æ•°æ®åº“
systemctl status postgresql

# æ£€æŸ¥åç«¯
systemctl status photopolymer-api.service

# æ£€æŸ¥ Nginx
systemctl status nginx
```

æ‰€æœ‰æœåŠ¡åº”è¯¥æ˜¾ç¤º `active (running)`ã€‚

### 2. æ£€æŸ¥ç«¯å£ç›‘å¬

```bash
# æ£€æŸ¥åç«¯ç«¯å£ 8000
sudo lsof -i :8000

# æ£€æŸ¥ Nginx ç«¯å£ 8080
sudo lsof -i :8080

# æ£€æŸ¥æ•°æ®åº“ç«¯å£ 5432
sudo lsof -i :5432
```

### 3. æµ‹è¯•è®¿é—®

```bash
# æµ‹è¯•åç«¯ API
curl http://localhost:8000/docs

# æµ‹è¯•å‰ç«¯
curl http://localhost:8080
```

### 4. æµè§ˆå™¨è®¿é—®

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- å‰ç«¯åº”ç”¨ï¼š`http://YOUR_SERVER_IP:8080`
- åç«¯æ–‡æ¡£ï¼š`http://YOUR_SERVER_IP:8000/docs`

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šé˜²ç«å¢™é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# å…è®¸ 8080 ç«¯å£ï¼ˆå‰ç«¯ï¼‰
sudo ufw allow 8080/tcp

# å…è®¸ SSHï¼ˆé‡è¦ï¼é¿å…è¢«é”å®šï¼‰
sudo ufw allow 22/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

---

## ğŸ“ æ•…éšœæ’æŸ¥

### åç«¯å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u photopolymer-api.service -n 100 --no-pager

# å¸¸è§é”™è¯¯ï¼š
# - "CHDIR failed" â†’ è·¯å¾„é…ç½®é”™è¯¯ï¼Œæ£€æŸ¥ photopolymer-api.service
# - "ModuleNotFoundError" â†’ ä¾èµ–æœªå®‰è£…ï¼Œé‡æ–°è¿è¡Œ pip install
# - "Database connection failed" â†’ æ•°æ®åº“é…ç½®é”™è¯¯

# æ‰‹åŠ¨æµ‹è¯•å¯åŠ¨
source ~/venv/database/bin/activate
cd ~/workspace/database-bate-0.3/backend_fastapi
python main.py --env=prod
```

### Nginx å¯åŠ¨å¤±è´¥

```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# å¸¸è§é”™è¯¯ï¼š
# - "No such file or directory" â†’ å‰ç«¯ dist ç›®å½•ä¸å­˜åœ¨ï¼Œéœ€è¦å…ˆæ„å»º
# - "Permission denied" â†’ æƒé™é—®é¢˜ï¼Œæ£€æŸ¥ç›®å½•æƒé™

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ PostgreSQL çŠ¶æ€
systemctl status postgresql

# æµ‹è¯•è¿æ¥
psql -U photopolymer_admin -d photopolymer_formulation_db -h localhost

# å¦‚æœè¿æ¥å¤±è´¥ï¼Œæ£€æŸ¥ï¼š
# 1. æ•°æ®åº“æ˜¯å¦åˆ›å»º
# 2. ç”¨æˆ·æ˜¯å¦åˆ›å»º
# 3. å¯†ç æ˜¯å¦æ­£ç¡®
```

### å‰ç«¯ 403 Forbidden

```bash
# è®¾ç½®æ­£ç¡®çš„ç›®å½•æƒé™
chmod 755 ~
chmod 755 ~/workspace
chmod -R 755 ~/workspace/database-bate-0.3/frontend_vue3/dist
```

---

## ğŸ”„ å®Œæ•´å¯åŠ¨é¡ºåº

```bash
# 1. å¯åŠ¨æ•°æ®åº“
sudo systemctl start postgresql

# 2. å¯åŠ¨åç«¯
sudo systemctl start photopolymer-api.service

# 3. å¯åŠ¨ Nginx
sudo systemctl start nginx

# 4. æ£€æŸ¥æ‰€æœ‰æœåŠ¡
systemctl status postgresql photopolymer-api.service nginx
```

---

## ğŸ›‘ åœæ­¢æ‰€æœ‰æœåŠ¡

```bash
# ä½¿ç”¨åœæ­¢è„šæœ¬
bash stop_system.sh

# æˆ–æ‰‹åŠ¨åœæ­¢
sudo systemctl stop photopolymer-api.service
sudo systemctl stop nginx
sudo systemctl stop postgresql
```

---

**éƒ¨ç½²å®Œæˆï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- è¯¦ç»†è·¯å¾„é…ç½®ï¼š`doc/è·¯å¾„é…ç½®è¯´æ˜.md`
- æ–°æœåŠ¡å™¨éƒ¨ç½²ï¼š`doc/æ–°æœåŠ¡å™¨éƒ¨ç½²è·¯å¾„ä¿®æ”¹æ¸…å•.md`
- å¿«é€Ÿå‚è€ƒï¼š`æ–°æœåŠ¡å™¨éƒ¨ç½²å¿«é€Ÿå‚è€ƒ.md`

