# ä¿®æ”¹æ€»ç»“ - æ–°æœåŠ¡å™¨éƒ¨ç½²é€‚é…

æœ¬æ–‡æ¡£æ€»ç»“äº†ä¸ºé€‚é…æ–°æœåŠ¡å™¨éƒ¨ç½²æ‰€åšçš„æ‰€æœ‰ä¿®æ”¹ã€‚

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨

### 1. é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼ˆ2ä¸ªï¼‰

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | ä¿®æ”¹æ•°é‡ |
|------|---------|---------|
| `backend_fastapi/depoly/photopolymer-api.service` | ä¿®æ­£è·¯å¾„ï¼Œä½¿ç”¨ç»å¯¹è·¯å¾„ | 6å¤„ |
| `frontend_vue3/depoly/photopolymer-frontend.conf` | ä¿®æ­£è·¯å¾„å’Œç«¯å£ | 2å¤„ |

### 2. æ–°å¢è„šæœ¬ï¼ˆ2ä¸ªï¼‰

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `setup_new_server.sh` | è‡ªåŠ¨é…ç½®æ–°æœåŠ¡å™¨è·¯å¾„ |
| `update_configs.sh` | ä¸€é”®éƒ¨ç½²æœåŠ¡ |

### 3. æ–°å¢æ–‡æ¡£ï¼ˆ7ä¸ªï¼‰

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `doc/å®Œæ•´éƒ¨ç½²æŒ‡å—.md` | å®Œæ•´çš„éƒ¨ç½²æµç¨‹æ–‡æ¡£ |
| `doc/æ–°æœåŠ¡å™¨éƒ¨ç½²è·¯å¾„ä¿®æ”¹æ¸…å•.md` | è·¯å¾„ä¿®æ”¹è¯¦ç»†æ¸…å• |
| `æ–°æœåŠ¡å™¨éƒ¨ç½²å¿«é€Ÿå‚è€ƒ.md` | å¿«é€Ÿå‚è€ƒå¡ç‰‡ |
| `doc/è·¯å¾„é…ç½®è¯´æ˜.md` | è·¯å¾„é…ç½®è¯¦ç»†è¯´æ˜ |
| `PATH_CHANGES_SUMMARY.md` | è·¯å¾„ä¿®æ”¹æ€»ç»“ |
| `DEPLOYMENT_STEPS.md` | ç®€åŒ–çš„éƒ¨ç½²æ­¥éª¤ |
| `doc/éƒ¨ç½²æ­¥éª¤å¯¹æ¯”-ä¿®æ”¹å‰å.md` | ä¿®æ”¹å‰åå¯¹æ¯” |

---

## ğŸ”§ å…·ä½“ä¿®æ”¹å†…å®¹

### ä¿®æ”¹ 1: backend_fastapi/depoly/photopolymer-api.service

**ä¿®æ”¹çš„ 6 å¤„è·¯å¾„**ï¼š

```diff
[Service]
- User=%u
+ User=xgs

- Group=%u
+ Group=xgs

- WorkingDirectory=%h/workspace/data_base/database-bate-0.3/backend_fastapi
+ WorkingDirectory=/home/xgs/workspace/database-bate-0.3/backend_fastapi

- Environment="PATH=%h/venv/database/bin:/usr/local/bin:/usr/bin:/bin"
+ Environment="PATH=/home/xgs/venv/database/bin:/usr/local/bin:/usr/bin:/bin"

- Environment="PYTHONPATH=%h/workspace/data_base/database-bate-0.3/backend_fastapi"
+ Environment="PYTHONPATH=/home/xgs/workspace/database-bate-0.3/backend_fastapi"

- ExecStart=%h/venv/database/bin/python %h/workspace/data_base/database-bate-0.3/backend_fastapi/main.py --env=prod
+ ExecStart=/home/xgs/venv/database/bin/python /home/xgs/workspace/database-bate-0.3/backend_fastapi/main.py --env=prod
```

**ä¿®æ”¹åŸå› **ï¼š
- âŒ åŸè·¯å¾„åŒ…å«ä¸å­˜åœ¨çš„ `data_base` ç›®å½•
- âŒ ä½¿ç”¨äº†å˜é‡ `%h` å’Œ `%u`
- âœ… æ”¹ä¸ºç»å¯¹è·¯å¾„ï¼Œé¿å…è§£æé”™è¯¯

---

### ä¿®æ”¹ 2: frontend_vue3/depoly/photopolymer-frontend.conf

**ä¿®æ”¹çš„ 2 å¤„**ï¼š

```diff
- root __PROJECT_ROOT__/frontend_vue3/dist;
+ root /home/xgs/workspace/database-bate-0.3/frontend_vue3/dist;

- proxy_pass http://localhost:8080;
+ proxy_pass http://localhost:8000;
```

**ä¿®æ”¹åŸå› **ï¼š
- âŒ åŸé…ç½®ä½¿ç”¨å ä½ç¬¦ `__PROJECT_ROOT__`
- âŒ API ä»£ç†ç«¯å£é”™è¯¯ï¼ˆ8080 æ˜¯å‰ç«¯ç«¯å£ï¼Œåº”è¯¥æ˜¯ 8000ï¼‰
- âœ… æ”¹ä¸ºç»å¯¹è·¯å¾„å’Œæ­£ç¡®çš„åç«¯ç«¯å£

---

## ğŸ†• æ–°å¢åŠŸèƒ½

### 1. setup_new_server.sh - è‡ªåŠ¨é…ç½®è„šæœ¬

**åŠŸèƒ½**ï¼š
- âœ… äº¤äº’å¼è¯¢é—®æ–°æœåŠ¡å™¨ä¿¡æ¯ï¼ˆç”¨æˆ·åã€è·¯å¾„ã€ç«¯å£ç­‰ï¼‰
- âœ… è‡ªåŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰è·¯å¾„
- âœ… è‡ªåŠ¨å¤‡ä»½åŸå§‹é…ç½®æ–‡ä»¶
- âœ… éªŒè¯ä¿®æ”¹ç»“æœ
- âœ… æ˜¾ç¤ºä¸‹ä¸€æ­¥æ“ä½œæŒ‡å¼•

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
cd /path/to/project
bash setup_new_server.sh
```

---

### 2. update_configs.sh - ä¸€é”®éƒ¨ç½²è„šæœ¬

**åŠŸèƒ½**ï¼š
- âœ… åœæ­¢ç°æœ‰æœåŠ¡
- âœ… å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°ç³»ç»Ÿç›®å½•
- âœ… æµ‹è¯• Nginx é…ç½®
- âœ… é‡æ–°åŠ è½½ systemd
- âœ… å¯åŠ¨æ‰€æœ‰æœåŠ¡
- âœ… æ˜¾ç¤ºæœåŠ¡çŠ¶æ€å’Œç«¯å£ç›‘å¬æƒ…å†µ
- âœ… æä¾›æ—¥å¿—æŸ¥çœ‹å‘½ä»¤

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
cd /path/to/project
bash update_configs.sh
```

---

## ğŸ“š æ–‡æ¡£ä½“ç³»

### å¿«é€Ÿå…¥é—¨
- **DEPLOYMENT_STEPS.md** - ç®€åŒ–çš„éƒ¨ç½²æ­¥éª¤ï¼Œé€‚åˆå¿«é€Ÿéƒ¨ç½²

### è¯¦ç»†æŒ‡å—
- **doc/å®Œæ•´éƒ¨ç½²æŒ‡å—.md** - å®Œæ•´çš„éƒ¨ç½²æµç¨‹ï¼ŒåŒ…å«æ‰€æœ‰ç»†èŠ‚

### è·¯å¾„é…ç½®
- **æ–°æœåŠ¡å™¨éƒ¨ç½²å¿«é€Ÿå‚è€ƒ.md** - å¿«é€Ÿå‚è€ƒå¡ç‰‡
- **doc/æ–°æœåŠ¡å™¨éƒ¨ç½²è·¯å¾„ä¿®æ”¹æ¸…å•.md** - è¯¦ç»†çš„è·¯å¾„ä¿®æ”¹æ¸…å•
- **doc/è·¯å¾„é…ç½®è¯´æ˜.md** - è·¯å¾„é…ç½®è¯¦ç»†è¯´æ˜

### ä¿®æ”¹è®°å½•
- **PATH_CHANGES_SUMMARY.md** - è·¯å¾„ä¿®æ”¹æ€»ç»“
- **doc/éƒ¨ç½²æ­¥éª¤å¯¹æ¯”-ä¿®æ”¹å‰å.md** - ä¿®æ”¹å‰åå¯¹æ¯”

---

## ğŸ¯ ä¸»è¦æ”¹è¿›

### 1. ä¿®æ­£è·¯å¾„é”™è¯¯
- âŒ ç§»é™¤ä¸å­˜åœ¨çš„ `data_base` ç›®å½•
- âœ… ä½¿ç”¨æ­£ç¡®çš„é¡¹ç›®ç»“æ„è·¯å¾„

### 2. é€‚é…æ–°æœåŠ¡å™¨
- âŒ åŸé…ç½®ç¡¬ç¼–ç è·¯å¾„ï¼Œæ— æ³•é€‚é…ä¸åŒç¯å¢ƒ
- âœ… æä¾›è‡ªåŠ¨é…ç½®å·¥å…·ï¼Œæ”¯æŒä»»æ„è·¯å¾„

### 3. è‡ªåŠ¨åŒ–éƒ¨ç½²
- âŒ åŸæµç¨‹éœ€è¦æ‰‹åŠ¨æ‰§è¡Œå¤šä¸ªå‘½ä»¤
- âœ… æä¾›ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼Œå‡å°‘äººä¸ºé”™è¯¯

### 4. å®Œå–„æ–‡æ¡£
- âŒ åŸæ–‡æ¡£è·¯å¾„é”™è¯¯ï¼Œç¼ºå°‘æ–°æœåŠ¡å™¨é…ç½®è¯´æ˜
- âœ… æä¾›å®Œæ•´çš„æ–‡æ¡£ä½“ç³»ï¼Œè¦†ç›–å„ç§åœºæ™¯

### 5. æé«˜å¯ç»´æŠ¤æ€§
- âŒ åŸé…ç½®ä½¿ç”¨å ä½ç¬¦å’Œå˜é‡
- âœ… ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œé…ç½®æ¸…æ™°æ˜ç¡®

---

## ğŸ“Š ä¿®æ”¹ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ |
|------|------|
| ä¿®æ”¹çš„é…ç½®æ–‡ä»¶ | 2ä¸ª |
| ä¿®æ­£çš„è·¯å¾„ | 8å¤„ |
| æ–°å¢çš„è„šæœ¬ | 2ä¸ª |
| æ–°å¢çš„æ–‡æ¡£ | 7ä¸ª |
| æ€»ä»£ç è¡Œæ•° | ~1000è¡Œ |

---

## âœ… ä½¿ç”¨å»ºè®®

### æ–°æœåŠ¡å™¨éƒ¨ç½²æµç¨‹

1. **å…‹éš†ä»£ç **
   ```bash
   git clone https://github.com/shuo1104/database-bate-0.3.git
   cd database-bate-0.3
   ```

2. **é…ç½®è·¯å¾„**ï¼ˆâ­ å…³é”®æ­¥éª¤ï¼‰
   ```bash
   bash setup_new_server.sh
   ```

3. **å®‰è£…ä¾èµ–**
   ```bash
   # å‚è€ƒ DEPLOYMENT_STEPS.md ç¬¬ä¸€éƒ¨åˆ†
   ```

4. **éƒ¨ç½²æœåŠ¡**
   ```bash
   bash update_configs.sh
   ```

5. **éªŒè¯éƒ¨ç½²**
   ```bash
   systemctl status photopolymer-api.service
   systemctl status nginx
   curl http://localhost:8080
   ```

---

## ğŸ” éªŒè¯æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·éªŒè¯ï¼š

- [ ] åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œï¼š`systemctl status photopolymer-api.service`
- [ ] å‰ç«¯æœåŠ¡æ­£å¸¸è¿è¡Œï¼š`systemctl status nginx`
- [ ] åç«¯ç«¯å£ç›‘å¬ï¼š`sudo lsof -i :8000`
- [ ] å‰ç«¯ç«¯å£ç›‘å¬ï¼š`sudo lsof -i :8080`
- [ ] å‰ç«¯å¯è®¿é—®ï¼š`http://localhost:8080`
- [ ] åç«¯ API å¯è®¿é—®ï¼š`http://localhost:8000/docs`
- [ ] å‰ç«¯å¯ä»¥è°ƒç”¨åç«¯ APIï¼ˆç™»å½•æµ‹è¯•ï¼‰

---

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. **æ•…éšœæ’æŸ¥**ï¼š`DEPLOYMENT_STEPS.md` ä¸­çš„"æ•…éšœæ’æŸ¥"éƒ¨åˆ†
2. **æ—¥å¿—æŸ¥çœ‹**ï¼š
   - åç«¯ï¼š`sudo journalctl -u photopolymer-api.service -n 100 --no-pager`
   - å‰ç«¯ï¼š`sudo tail -f /var/log/nginx/photopolymer-error.log`

---

**ä¿®æ”¹å®Œæˆæ—¶é—´**ï¼š2025-11-19  
**ç‰ˆæœ¬**ï¼š1.0

