# è·¯å¾„é…ç½®è¯´æ˜æ–‡æ¡£

æœ¬æ–‡æ¡£è®°å½•äº†ç³»ç»Ÿéƒ¨ç½²æ—¶éœ€è¦é…ç½®çš„æ‰€æœ‰è·¯å¾„ä¿¡æ¯ã€‚

---

## ğŸ“‹ å…³é”®è·¯å¾„æ±‡æ€»

### 1. é¡¹ç›®æ ¹ç›®å½•
```
/home/xgs/workspace/database-bate-0.3
```

### 2. åç«¯ç›®å½•
```
/home/xgs/workspace/database-bate-0.3/backend_fastapi
```

### 3. å‰ç«¯ç›®å½•
```
/home/xgs/workspace/database-bate-0.3/frontend_vue3
```

### 4. å‰ç«¯æ„å»ºè¾“å‡ºç›®å½•
```
/home/xgs/workspace/database-bate-0.3/frontend_vue3/dist
```

### 5. Python è™šæ‹Ÿç¯å¢ƒç›®å½•
```
/home/xgs/venv/database
```

### 6. Python è§£é‡Šå™¨è·¯å¾„
```
/home/xgs/venv/database/bin/python
```

---

## ğŸ”§ é…ç½®æ–‡ä»¶è·¯å¾„ä¿®æ”¹è®°å½•

### 1. åç«¯ Systemd æœåŠ¡é…ç½®

**æ–‡ä»¶ä½ç½®**: `backend_fastapi/deploy/photopolymer-api.service`

**å·²ä¿®æ”¹çš„è·¯å¾„**:
- `User`: `xgs` (åŸæ¥æ˜¯ `%u`)
- `Group`: `xgs` (åŸæ¥æ˜¯ `%u`)
- `WorkingDirectory`: `/home/xgs/workspace/database-bate-0.3/backend_fastapi`
  - åŸæ¥: `%h/workspace/data_base/database-bate-0.3/backend_fastapi` âŒ
- `Environment PATH`: `/home/xgs/venv/database/bin:/usr/local/bin:/usr/bin:/bin`
  - åŸæ¥: `%h/venv/database/bin:...` âŒ
- `Environment PYTHONPATH`: `/home/xgs/workspace/database-bate-0.3/backend_fastapi`
  - åŸæ¥: `%h/workspace/data_base/database-bate-0.3/backend_fastapi` âŒ
- `ExecStart`: `/home/xgs/venv/database/bin/python /home/xgs/workspace/database-bate-0.3/backend_fastapi/main.py --env=prod`
  - åŸæ¥: `%h/venv/database/bin/python %h/workspace/data_base/database-bate-0.3/backend_fastapi/main.py --env=prod` âŒ

**é—®é¢˜è¯´æ˜**:
- åŸé…ç½®ä½¿ç”¨äº† `%h` (homeç›®å½•å˜é‡) å’Œ `%u` (ç”¨æˆ·åå˜é‡)
- åŸé…ç½®è·¯å¾„ä¸­æœ‰ `data_base` ç›®å½•ï¼Œä½†å®é™…é¡¹ç›®ä¸­ä¸å­˜åœ¨æ­¤ç›®å½•
- ç°å·²å…¨éƒ¨æ”¹ä¸ºç»å¯¹è·¯å¾„ï¼Œé¿å…è·¯å¾„è§£æé”™è¯¯

---

### 2. å‰ç«¯ Nginx é…ç½®

**æ–‡ä»¶ä½ç½®**: `frontend_vue3/deploy/photopolymer-frontend.conf`

**å·²ä¿®æ”¹çš„è·¯å¾„**:
- `root`: `/home/xgs/workspace/database-bate-0.3/frontend_vue3/dist`
  - åŸæ¥: `__PROJECT_ROOT__/frontend_vue3/dist` âŒ (å ä½ç¬¦)
- `proxy_pass`: `http://localhost:8000`
  - åŸæ¥: `http://localhost:8080` âŒ (ç«¯å£é”™è¯¯)

**é—®é¢˜è¯´æ˜**:
- åŸé…ç½®ä½¿ç”¨äº† `__PROJECT_ROOT__` å ä½ç¬¦ï¼Œéœ€è¦æ›¿æ¢ä¸ºå®é™…è·¯å¾„
- API ä»£ç†ç«¯å£é”™è¯¯ï¼Œåº”è¯¥ä»£ç†åˆ°åç«¯çš„ 8000 ç«¯å£ï¼Œè€Œä¸æ˜¯å‰ç«¯çš„ 8080 ç«¯å£

---

## âš ï¸ å¸¸è§è·¯å¾„é”™è¯¯

### é”™è¯¯ 1: `data_base` ç›®å½•ä¸å­˜åœ¨
```
âŒ é”™è¯¯: /home/xgs/workspace/data_base/database-bate-0.3/
âœ… æ­£ç¡®: /home/xgs/workspace/database-bate-0.3/
```

### é”™è¯¯ 2: API ä»£ç†ç«¯å£é”™è¯¯
```
âŒ é”™è¯¯: proxy_pass http://localhost:8080;  (è¿™æ˜¯å‰ç«¯ç«¯å£)
âœ… æ­£ç¡®: proxy_pass http://localhost:8000;  (è¿™æ˜¯åç«¯ç«¯å£)
```

### é”™è¯¯ 3: ä½¿ç”¨ç›¸å¯¹è·¯å¾„æˆ–å˜é‡
```
âŒ é”™è¯¯: %h/workspace/...
âŒ é”™è¯¯: ~/workspace/...
âŒ é”™è¯¯: __PROJECT_ROOT__/...
âœ… æ­£ç¡®: /home/xgs/workspace/database-bate-0.3/...
```

---

## ğŸš€ éƒ¨ç½²åéœ€è¦æ‰§è¡Œçš„å‘½ä»¤

### 1. æ›´æ–° Systemd æœåŠ¡é…ç½®
```bash
# å¤åˆ¶æœåŠ¡æ–‡ä»¶åˆ°ç³»ç»Ÿç›®å½•
sudo cp /home/xgs/workspace/database-bate-0.3/backend_fastapi/deploy/photopolymer-api.service /etc/systemd/system/

# é‡æ–°åŠ è½½ systemd é…ç½®
sudo systemctl daemon-reload

# é‡å¯åç«¯æœåŠ¡
sudo systemctl restart photopolymer-api.service

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status photopolymer-api.service
```

### 2. æ›´æ–° Nginx é…ç½®
```bash
# å¤åˆ¶ Nginx é…ç½®æ–‡ä»¶
sudo cp /home/xgs/workspace/database-bate-0.3/frontend_vue3/deploy/photopolymer-frontend.conf /etc/nginx/sites-available/photopolymer

# åˆ›å»ºè½¯é“¾æ¥ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
sudo ln -sf /etc/nginx/sites-available/photopolymer /etc/nginx/sites-enabled/photopolymer

# æµ‹è¯• Nginx é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½ Nginx
sudo systemctl reload nginx

# æŸ¥çœ‹ Nginx çŠ¶æ€
sudo systemctl status nginx
```

---

## ğŸ“ å…¶ä»–éœ€è¦æ³¨æ„çš„è·¯å¾„

### 1. æ—¥å¿—æ–‡ä»¶è·¯å¾„
- Nginx è®¿é—®æ—¥å¿—: `/var/log/nginx/photopolymer-access.log`
- Nginx é”™è¯¯æ—¥å¿—: `/var/log/nginx/photopolymer-error.log`
- åç«¯æ—¥å¿—: é€šè¿‡ `journalctl -u photopolymer-api.service` æŸ¥çœ‹

### 2. æ•°æ®åº“é…ç½®
å¦‚æœåç«¯é…ç½®æ–‡ä»¶ä¸­æœ‰æ•°æ®åº“è·¯å¾„ï¼Œä¹Ÿéœ€è¦æ£€æŸ¥ï¼š
- é…ç½®æ–‡ä»¶ä½ç½®: `backend_fastapi/app/config/settings.py` æˆ– `backend_fastapi/env/.env.prod`

---

## âœ… éªŒè¯æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·éªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

- [ ] åç«¯æœåŠ¡æ­£å¸¸å¯åŠ¨: `sudo systemctl status photopolymer-api.service`
- [ ] åç«¯ç›‘å¬ 8000 ç«¯å£: `sudo lsof -i :8000`
- [ ] Nginx æ­£å¸¸è¿è¡Œ: `sudo systemctl status nginx`
- [ ] Nginx ç›‘å¬ 8080 ç«¯å£: `sudo lsof -i :8080`
- [ ] å‰ç«¯å¯ä»¥è®¿é—®: `http://localhost:8080`
- [ ] API å¯ä»¥è®¿é—®: `http://localhost:8000/docs` (å¦‚æœå¯ç”¨)
- [ ] å‰ç«¯å¯ä»¥è°ƒç”¨åç«¯ API: ç™»å½•æµ‹è¯•

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-11-19  
**æœ€åæ›´æ–°**: 2025-11-19
