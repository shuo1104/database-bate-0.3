# æ–°æœåŠ¡å™¨éƒ¨ç½²è·¯å¾„ä¿®æ”¹æ¸…å•

## ğŸ“‹ éƒ¨ç½²å‰éœ€è¦ç¡®å®šçš„ä¿¡æ¯

åœ¨æ–°æœåŠ¡å™¨ä¸Šéƒ¨ç½²å‰ï¼Œè¯·å…ˆç¡®å®šä»¥ä¸‹ä¿¡æ¯ï¼š

| é¡¹ç›® | å½“å‰æœåŠ¡å™¨ | æ–°æœåŠ¡å™¨ | è¯´æ˜ |
|------|-----------|---------|------|
| ç”¨æˆ·å | `xgs` | `?` | è¿è¡ŒæœåŠ¡çš„ç”¨æˆ· |
| ç”¨æˆ·ç»„ | `xgs` | `?` | è¿è¡ŒæœåŠ¡çš„ç”¨æˆ·ç»„ |
| é¡¹ç›®æ ¹ç›®å½• | `/home/xgs/workspace/database-bate-0.3` | `?` | é¡¹ç›®ä»£ç å­˜æ”¾ä½ç½® |
| è™šæ‹Ÿç¯å¢ƒç›®å½• | `/home/xgs/venv/database` | `?` | Python è™šæ‹Ÿç¯å¢ƒä½ç½® |
| å‰ç«¯ç«¯å£ | `8080` | `?` | Nginx ç›‘å¬ç«¯å£ |
| åç«¯ç«¯å£ | `8000` | `?` | FastAPI ç›‘å¬ç«¯å£ |

---

## ğŸ”§ éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### 1ï¸âƒ£ **backend_fastapi/depoly/photopolymer-api.service**

**éœ€è¦ä¿®æ”¹çš„è·¯å¾„ï¼ˆå…± 6 å¤„ï¼‰**:

```ini
[Service]
User=xgs                    # â† ä¿®æ”¹ä¸ºæ–°æœåŠ¡å™¨çš„ç”¨æˆ·å
Group=xgs                   # â† ä¿®æ”¹ä¸ºæ–°æœåŠ¡å™¨çš„ç”¨æˆ·ç»„

# â† ä¿®æ”¹ä¸ºæ–°æœåŠ¡å™¨çš„é¡¹ç›®åç«¯ç›®å½•
WorkingDirectory=/home/xgs/workspace/database-bate-0.3/backend_fastapi

# â† ä¿®æ”¹ä¸ºæ–°æœåŠ¡å™¨çš„è™šæ‹Ÿç¯å¢ƒè·¯å¾„
Environment="PATH=/home/xgs/venv/database/bin:/usr/local/bin:/usr/bin:/bin"

# â† ä¿®æ”¹ä¸ºæ–°æœåŠ¡å™¨çš„é¡¹ç›®åç«¯ç›®å½•
Environment="PYTHONPATH=/home/xgs/workspace/database-bate-0.3/backend_fastapi"

# â† ä¿®æ”¹ä¸ºæ–°æœåŠ¡å™¨çš„è™šæ‹Ÿç¯å¢ƒå’Œé¡¹ç›®è·¯å¾„
ExecStart=/home/xgs/venv/database/bin/python /home/xgs/workspace/database-bate-0.3/backend_fastapi/main.py --env=prod
```

**ä¿®æ”¹ç¤ºä¾‹**ï¼ˆå‡è®¾æ–°æœåŠ¡å™¨ç”¨æˆ·ä¸º `ubuntu`ï¼Œé¡¹ç›®åœ¨ `/opt/photopolymer`ï¼‰:

```ini
[Service]
User=ubuntu
Group=ubuntu
WorkingDirectory=/opt/photopolymer/backend_fastapi
Environment="PATH=/home/ubuntu/venv/database/bin:/usr/local/bin:/usr/bin:/bin"
Environment="PYTHONPATH=/opt/photopolymer/backend_fastapi"
ExecStart=/home/ubuntu/venv/database/bin/python /opt/photopolymer/backend_fastapi/main.py --env=prod
```

---

### 2ï¸âƒ£ **frontend_vue3/depoly/photopolymer-frontend.conf**

**éœ€è¦ä¿®æ”¹çš„è·¯å¾„ï¼ˆå…± 2 å¤„ï¼‰**:

```nginx
server {
    listen 8080;            # â† å¦‚æœéœ€è¦ï¼Œä¿®æ”¹å‰ç«¯ç«¯å£
    
    # â† ä¿®æ”¹ä¸ºæ–°æœåŠ¡å™¨çš„å‰ç«¯æ„å»ºç›®å½•
    root /home/xgs/workspace/database-bate-0.3/frontend_vue3/dist;
    
    location /api/ {
        # â† å¦‚æœåç«¯ç«¯å£æ”¹å˜ï¼Œä¿®æ”¹è¿™é‡Œ
        proxy_pass http://localhost:8000;
    }
}
```

**ä¿®æ”¹ç¤ºä¾‹**ï¼ˆå‡è®¾é¡¹ç›®åœ¨ `/opt/photopolymer`ï¼‰:

```nginx
server {
    listen 8080;
    root /opt/photopolymer/frontend_vue3/dist;
    
    location /api/ {
        proxy_pass http://localhost:8000;
    }
}
```

---

### 3ï¸âƒ£ **backend_fastapi/env/.env.prod** (å¦‚æœå­˜åœ¨)

**éœ€è¦æ£€æŸ¥çš„é…ç½®**:

```env
# æ•°æ®åº“é…ç½®
DB_HOST=localhost           # â† ä¿®æ”¹ä¸ºæ–°æœåŠ¡å™¨çš„æ•°æ®åº“åœ°å€
DB_PORT=5432
DB_USER=photopolymer_admin  # â† ä¿®æ”¹ä¸ºæ–°æœåŠ¡å™¨çš„æ•°æ®åº“ç”¨æˆ·
DB_PASSWORD=root            # â† ä¿®æ”¹ä¸ºæ–°æœåŠ¡å™¨çš„æ•°æ®åº“å¯†ç 
DB_DATABASE=photopolymer_formulation_db  # â† ä¿®æ”¹ä¸ºæ–°æœåŠ¡å™¨çš„æ•°æ®åº“å

# æœåŠ¡å™¨é…ç½®
SERVER_HOST=0.0.0.0
SERVER_PORT=8000            # â† å¦‚æœéœ€è¦ï¼Œä¿®æ”¹åç«¯ç«¯å£

# å®‰å…¨é…ç½®
SECRET_KEY=your-secret-key  # â† å¿…é¡»ä¿®æ”¹ä¸ºæ–°çš„å¼ºå¯†é’¥
```

---

### 4ï¸âƒ£ **deploy.sh** å’Œ **install_and_deploy.sh**

è¿™ä¸¤ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨ä½¿ç”¨ `$SCRIPT_DIR` è·å–é¡¹ç›®è·¯å¾„ï¼Œ**é€šå¸¸ä¸éœ€è¦ä¿®æ”¹**ã€‚

ä½†å¦‚æœè„šæœ¬ä¸­æœ‰ç¡¬ç¼–ç è·¯å¾„ï¼Œéœ€è¦æ£€æŸ¥å¹¶ä¿®æ”¹ã€‚

---

### 5ï¸âƒ£ **update_configs.sh**

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨ä½¿ç”¨ `$SCRIPT_DIR` è·å–é¡¹ç›®è·¯å¾„ï¼Œ**é€šå¸¸ä¸éœ€è¦ä¿®æ”¹**ã€‚

---

## ğŸ“ ä¿®æ”¹æ­¥éª¤ï¼ˆæ¨èæµç¨‹ï¼‰

### æ­¥éª¤ 1: å…‹éš†ä»£ç åˆ°æ–°æœåŠ¡å™¨

```bash
# åœ¨æ–°æœåŠ¡å™¨ä¸Š
cd /your/new/path
git clone https://github.com/shuo1104/database-bate-0.3.git
cd database-bate-0.3
```

### æ­¥éª¤ 2: è®°å½•æ–°æœåŠ¡å™¨ä¿¡æ¯

```bash
# è·å–å½“å‰ç”¨æˆ·
whoami                    # ä¾‹å¦‚: ubuntu

# è·å–å½“å‰ç”¨æˆ·ç»„
id -gn                    # ä¾‹å¦‚: ubuntu

# è·å–é¡¹ç›®ç»å¯¹è·¯å¾„
pwd                       # ä¾‹å¦‚: /opt/photopolymer

# ç¡®å®šè™šæ‹Ÿç¯å¢ƒè·¯å¾„ï¼ˆå»ºè®®ï¼‰
echo "$HOME/venv/database"  # ä¾‹å¦‚: /home/ubuntu/venv/database
```

### æ­¥éª¤ 3: ä¿®æ”¹é…ç½®æ–‡ä»¶

ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼š

```bash
# ä¿®æ”¹åç«¯æœåŠ¡é…ç½®
nano backend_fastapi/depoly/photopolymer-api.service

# ä¿®æ”¹å‰ç«¯ Nginx é…ç½®
nano frontend_vue3/depoly/photopolymer-frontend.conf

# å¦‚æœå­˜åœ¨ï¼Œä¿®æ”¹ç¯å¢ƒé…ç½®
nano backend_fastapi/env/.env.prod
```

**æˆ–è€…ä½¿ç”¨ sed æ‰¹é‡æ›¿æ¢**ï¼ˆæ¨èï¼‰:

```bash
# è®¾ç½®å˜é‡
OLD_USER="xgs"
NEW_USER="ubuntu"
OLD_PATH="/home/xgs/workspace/database-bate-0.3"
NEW_PATH="/opt/photopolymer"
OLD_VENV="/home/xgs/venv/database"
NEW_VENV="/home/ubuntu/venv/database"

# æ›¿æ¢åç«¯æœåŠ¡é…ç½®
sed -i "s|User=$OLD_USER|User=$NEW_USER|g" backend_fastapi/depoly/photopolymer-api.service
sed -i "s|Group=$OLD_USER|Group=$NEW_USER|g" backend_fastapi/depoly/photopolymer-api.service
sed -i "s|$OLD_PATH|$NEW_PATH|g" backend_fastapi/depoly/photopolymer-api.service
sed -i "s|$OLD_VENV|$NEW_VENV|g" backend_fastapi/depoly/photopolymer-api.service

# æ›¿æ¢å‰ç«¯ Nginx é…ç½®
sed -i "s|$OLD_PATH|$NEW_PATH|g" frontend_vue3/depoly/photopolymer-frontend.conf
```

### æ­¥éª¤ 4: åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒç›®å½•
mkdir -p ~/venv

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv ~/venv/database

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source ~/venv/database/bin/activate

# å®‰è£…ä¾èµ–
cd backend_fastapi
pip install -r requirements.txt
```

### æ­¥éª¤ 5: æ„å»ºå‰ç«¯

```bash
cd ../frontend_vue3
pnpm install
pnpm build
```

### æ­¥éª¤ 6: é…ç½®æ•°æ®åº“

```bash
# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·ï¼ˆæ ¹æ®æ‚¨çš„é…ç½®ï¼‰
sudo -u postgres psql

# åœ¨ psql ä¸­æ‰§è¡Œï¼š
CREATE DATABASE photopolymer_formulation_db;
CREATE USER photopolymer_admin WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE photopolymer_formulation_db TO photopolymer_admin;
\q
```

### æ­¥éª¤ 7: è®¾ç½®æ–‡ä»¶æƒé™

```bash
# ç¡®ä¿ Nginx å¯ä»¥è®¿é—®é¡¹ç›®ç›®å½•
chmod 755 ~
chmod 755 ~/workspace  # å¦‚æœå­˜åœ¨
chmod -R 755 /path/to/project/frontend_vue3/dist
```

### æ­¥éª¤ 8: éƒ¨ç½²æœåŠ¡

```bash
cd /path/to/project
bash update_configs.sh
```

---

## ğŸ” å¿«é€Ÿæ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰è¯·ç¡®è®¤ï¼š

- [ ] å·²ä¿®æ”¹ `backend_fastapi/depoly/photopolymer-api.service` ä¸­çš„æ‰€æœ‰è·¯å¾„
- [ ] å·²ä¿®æ”¹ `frontend_vue3/depoly/photopolymer-frontend.conf` ä¸­çš„æ‰€æœ‰è·¯å¾„
- [ ] å·²åˆ›å»ºå¹¶é…ç½® Python è™šæ‹Ÿç¯å¢ƒ
- [ ] å·²å®‰è£…åç«¯ä¾èµ– (`pip install -r requirements.txt`)
- [ ] å·²æ„å»ºå‰ç«¯ (`pnpm build`)
- [ ] å·²åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
- [ ] å·²é…ç½® `backend_fastapi/env/.env.prod` (å¦‚æœå­˜åœ¨)
- [ ] å·²è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™
- [ ] å·²å®‰è£… PostgreSQLã€Nginx

---

## ğŸš€ ä¸€é”®æ›¿æ¢è„šæœ¬

æˆ‘å¯ä»¥ä¸ºæ‚¨åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨æ›¿æ¢è·¯å¾„çš„è„šæœ¬ï¼Œåªéœ€è¦è¾“å…¥æ–°æœåŠ¡å™¨çš„ä¿¡æ¯å³å¯ã€‚

æ˜¯å¦éœ€è¦åˆ›å»ºè¿™ä¸ªè„šæœ¬ï¼Ÿ

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-11-19

