# æ–°æœåŠ¡å™¨éƒ¨ç½²å¿«é€Ÿå‚è€ƒ

## ğŸ¯ éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆä»… 2 ä¸ªï¼‰

### 1. `backend_fastapi/deploy/photopolymer-api.service`
éœ€è¦ä¿®æ”¹ **6 å¤„**ï¼š
- `User=xgs` â†’ æ–°æœåŠ¡å™¨ç”¨æˆ·å
- `Group=xgs` â†’ æ–°æœåŠ¡å™¨ç”¨æˆ·ç»„
- `WorkingDirectory=/home/xgs/workspace/database-bate-0.3/backend_fastapi` â†’ æ–°è·¯å¾„
- `Environment PATH=/home/xgs/venv/database/bin:...` â†’ æ–°è™šæ‹Ÿç¯å¢ƒè·¯å¾„
- `Environment PYTHONPATH=/home/xgs/workspace/database-bate-0.3/backend_fastapi` â†’ æ–°è·¯å¾„
- `ExecStart=/home/xgs/venv/database/bin/python /home/xgs/workspace/database-bate-0.3/backend_fastapi/main.py --env=prod` â†’ æ–°è·¯å¾„

### 2. `frontend_vue3/deploy/photopolymer-frontend.conf`
éœ€è¦ä¿®æ”¹ **2 å¤„**ï¼š
- `root /home/xgs/workspace/database-bate-0.3/frontend_vue3/dist;` â†’ æ–°è·¯å¾„
- `proxy_pass http://localhost:8000;` â†’ å¦‚æœåç«¯ç«¯å£æ”¹å˜åˆ™ä¿®æ”¹

---

## ğŸš€ ä¸¤ç§éƒ¨ç½²æ–¹å¼

### æ–¹å¼ 1: è‡ªåŠ¨é…ç½®ï¼ˆæ¨èï¼‰

```bash
cd /path/to/project
bash setup_new_server.sh
```

è„šæœ¬ä¼šäº¤äº’å¼è¯¢é—®ï¼š
- æ–°æœåŠ¡å™¨ç”¨æˆ·å
- æ–°æœåŠ¡å™¨ç”¨æˆ·ç»„
- é¡¹ç›®è·¯å¾„
- è™šæ‹Ÿç¯å¢ƒè·¯å¾„
- åç«¯/å‰ç«¯ç«¯å£

ç„¶åè‡ªåŠ¨ä¿®æ”¹æ‰€æœ‰é…ç½®æ–‡ä»¶ã€‚

---

### æ–¹å¼ 2: æ‰‹åŠ¨é…ç½®

#### æ­¥éª¤ 1: ç¡®å®šæ–°æœåŠ¡å™¨ä¿¡æ¯
```bash
whoami                          # è·å–ç”¨æˆ·å
id -gn                          # è·å–ç”¨æˆ·ç»„
pwd                             # è·å–é¡¹ç›®è·¯å¾„
echo "$HOME/venv/database"      # è™šæ‹Ÿç¯å¢ƒè·¯å¾„ï¼ˆå»ºè®®ï¼‰
```

#### æ­¥éª¤ 2: ä½¿ç”¨ sed æ‰¹é‡æ›¿æ¢
```bash
# è®¾ç½®å˜é‡ï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰
NEW_USER="ubuntu"
NEW_GROUP="ubuntu"
NEW_PATH="/opt/photopolymer"
NEW_VENV="/home/ubuntu/venv/database"

# æ›¿æ¢åç«¯é…ç½®
sed -i "s|User=xgs|User=$NEW_USER|g" backend_fastapi/deploy/photopolymer-api.service
sed -i "s|Group=xgs|Group=$NEW_GROUP|g" backend_fastapi/deploy/photopolymer-api.service
sed -i "s|/home/xgs/workspace/database-bate-0.3|$NEW_PATH|g" backend_fastapi/deploy/photopolymer-api.service
sed -i "s|/home/xgs/venv/database|$NEW_VENV|g" backend_fastapi/deploy/photopolymer-api.service

# æ›¿æ¢å‰ç«¯é…ç½®
sed -i "s|/home/xgs/workspace/database-bate-0.3|$NEW_PATH|g" frontend_vue3/deploy/photopolymer-frontend.conf
```

---

## ğŸ“‹ å®Œæ•´éƒ¨ç½²æµç¨‹

### 1. å…‹éš†ä»£ç 
```bash
git clone https://github.com/shuo1104/database-bate-0.3.git
cd database-bate-0.3
```

### 2. é…ç½®è·¯å¾„
```bash
bash setup_new_server.sh
```

### 3. å®‰è£…ç³»ç»Ÿä¾èµ–
```bash
sudo apt update
sudo apt install -y postgresql postgresql-contrib nginx python3-venv python3-pip nodejs npm
npm install -g pnpm
```

### 4. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
mkdir -p ~/venv
python3 -m venv ~/venv/database
source ~/venv/database/bin/activate
cd backend_fastapi
pip install -r requirements.txt
```

### 5. æ„å»ºå‰ç«¯
```bash
cd ../frontend_vue3
pnpm install
pnpm build
```

### 6. é…ç½®æ•°æ®åº“
```bash
sudo -u postgres psql
```
```sql
CREATE DATABASE photopolymer_formulation_db;
CREATE USER photopolymer_admin WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE photopolymer_formulation_db TO photopolymer_admin;
\q
```

### 7. éƒ¨ç½²æœåŠ¡
```bash
cd ..
bash update_configs.sh
```

### 8. éªŒè¯éƒ¨ç½²
```bash
sudo systemctl status photopolymer-api.service
sudo systemctl status nginx
curl http://localhost:8080
```

---

## ğŸ” å…³é”®è·¯å¾„å¯¹ç…§è¡¨

| è·¯å¾„ç±»å‹ | å½“å‰æœåŠ¡å™¨ | éœ€è¦æ”¹ä¸º |
|---------|-----------|---------|
| ç”¨æˆ·å | `xgs` | æ–°æœåŠ¡å™¨ç”¨æˆ·å |
| é¡¹ç›®æ ¹ç›®å½• | `/home/xgs/workspace/database-bate-0.3` | æ–°æœåŠ¡å™¨é¡¹ç›®è·¯å¾„ |
| åç«¯ç›®å½• | `/home/xgs/workspace/database-bate-0.3/backend_fastapi` | `æ–°é¡¹ç›®è·¯å¾„/backend_fastapi` |
| å‰ç«¯ç›®å½• | `/home/xgs/workspace/database-bate-0.3/frontend_vue3/dist` | `æ–°é¡¹ç›®è·¯å¾„/frontend_vue3/dist` |
| è™šæ‹Ÿç¯å¢ƒ | `/home/xgs/venv/database` | æ–°æœåŠ¡å™¨è™šæ‹Ÿç¯å¢ƒè·¯å¾„ |
| Python | `/home/xgs/venv/database/bin/python` | `æ–°è™šæ‹Ÿç¯å¢ƒ/bin/python` |

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: å¦‚æœå¿˜è®°ä¿®æ”¹è·¯å¾„ä¼šæ€æ ·ï¼Ÿ
**A**: åç«¯æœåŠ¡æ— æ³•å¯åŠ¨ï¼Œsystemd ä¼šæŠ¥é”™ `CHDIR failed: No such file or directory`

### Q2: æ˜¯å¦éœ€è¦ä¿®æ”¹å…¶ä»–æ–‡ä»¶ï¼Ÿ
**A**: ä¸éœ€è¦ã€‚`deploy.sh`ã€`install_and_deploy.sh`ã€`update_configs.sh` éƒ½ä¼šè‡ªåŠ¨è·å–é¡¹ç›®è·¯å¾„ã€‚

### Q3: å¦‚ä½•æ¢å¤åŸå§‹é…ç½®ï¼Ÿ
**A**: `setup_new_server.sh` ä¼šè‡ªåŠ¨åˆ›å»ºå¤‡ä»½æ–‡ä»¶ï¼ˆ`.backup.æ—¶é—´æˆ³`ï¼‰ï¼Œå¯ä»¥ä»å¤‡ä»½æ¢å¤ã€‚

### Q4: ç«¯å£éœ€è¦ä¿®æ”¹å—ï¼Ÿ
**A**: é€šå¸¸ä¸éœ€è¦ã€‚é™¤éæ–°æœåŠ¡å™¨çš„ 8000 æˆ– 8080 ç«¯å£è¢«å ç”¨ã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- è¯¦ç»†è¯´æ˜: `doc/æ–°æœåŠ¡å™¨éƒ¨ç½²è·¯å¾„ä¿®æ”¹æ¸…å•.md`
- è·¯å¾„é…ç½®: `doc/è·¯å¾„é…ç½®è¯´æ˜.md`
- ä¿®æ”¹æ€»ç»“: `PATH_CHANGES_SUMMARY.md`

---

**å¿«é€Ÿè®°å¿†**: åªéœ€ä¿®æ”¹ 2 ä¸ªæ–‡ä»¶ï¼Œå…± 8 å¤„è·¯å¾„ï¼
